# /etc/nginx/conf.d/mcp.conf  ───────────────────────────────
upstream fastapi_mcp {
    server mcp:8000;        # docker-compose service 이름 or 내부 IP
    keepalive 64;
}

server {
    listen 80;
    server_name localhost;  # 필요 시 실제 FQDN으로 교체

    # ── FastAPI MCP 전용 ────────────────────────────────
    location /mcp/ {                # SSE(PUB)·RPC(POST) 모두 포함
        proxy_pass         http://fastapi_mcp$request_uri;
        proxy_http_version 1.1;     # SSE는 HTTP/1.1 필요
        proxy_set_header   Host            $host;
        proxy_set_header   X-Real-IP       $remote_addr;
        proxy_set_header   Connection      '';   # hop-by-hop 헤더 제거

        # 스트리밍 안정화
        proxy_buffering    off;      # 버퍼링 해제
        proxy_cache        off;

        # long-lived 연결용 타임아웃
        proxy_read_timeout 86400s;   # 24 h
        proxy_send_timeout 60s;
    }

    # ── 기타 경로: 필요 시 정적 파일·프론트엔드 등 추가 ─────────
    # location / { ... }
}
